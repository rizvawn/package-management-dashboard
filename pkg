#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
readonly SCRIPT_DIR

show_help() {
    cat << 'HELP'
	Package Management Tool

	Usage: pkg <command> [arguments]

	Commands:
	query [filter]		List installed packages (optional filter)
	search <term>		Search for packages in repositories
	info <packages>		Show detailed package information
	repos			Analyze configured repositories

	Examples
	pkg query python	# List installed Python packages
	pkg search editor	# Search for editor packages
	pkg info bash		# Show details about bash
	pkg repos		# Show repository status

	Options:
	-h, --help		Show this help message
	-v, --version		Show version information
HELP
}

show_version() {
	echo "pkg version 1.0.0"
}

main() {
	case "${1:-}" in
		-h|--help)
			show_help
			exit 0
			;;
		-v|--version)
			show_version
			exit 0
			;;
	esac

	local subcommand="${1:-}"
    if [[ -z "$subcommand" ]]; then
        echo "Error: No command specified"
        echo ""
        show_help
        exit 2
    fi

    shift

    case "$subcommand" in
        query)
            exec "${SCRIPT_DIR}/scripts/pkg-query.sh" "$@"
            ;;
        search)
            exec "${SCRIPT_DIR}/scripts/pkg-search.sh" "$@"
            ;;
        info)
            exec "${SCRIPT_DIR}/scripts/pkg-info.sh" "$@"
            ;;
        repos)
            exec "${SCRIPT_DIR}/scripts/repo-check.sh" "$@"
            ;;
        *)
            echo "Error: Unknown command '$subcommand'"
            echo ""
            show_help
            exit 2
            ;;
    esac
}

main "$@"

